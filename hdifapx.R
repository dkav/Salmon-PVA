# Estimate µ and σ2 from a series of population censuses# using Dennis-Holmes slope method
## Filename: hdifapx.R# Author: Darren Kavanagh# Created: 20.06.2009# Last Modified: 06.08.2009# ======================================================# Method outlined in Holmes (2001)# # Based on Splus code from Holmes 2004 # (see ESA Ecological Archives A014-023-S1.) ## Code assumes that there are no missing census years## parameter µ: determines how quickly the mean increases# parameter σ2: determines how quickly the variance in the normal#               distribution increases# taumax: the maximum tau to use for the slope regressionhdifapx <- function  (rscnt,taumax=5){ 	norscnt <- length(rscnt)     # not enough data for slope estimate 	if(norscnt<10) 	{ 	print("Not enough data for slope estimates")		return(list("NA"))				}				varrunsums <- c()	meanrunsums <- c()		for (i in 1:taumax)	{		runlogratios  <-  log(rscnt[(i+1):norscnt])-log(rscnt[1:(norscnt-i)])				varrunsums  <-  c(varrunsums,var(runlogratios))		meanrunsums  <-  c(meanrunsums,mean(runlogratios))	}		# slope of linear regression = parameter µ	lmmu  <-  lm(meanrunsums~c(1:length(meanrunsums)))	pmuslp <- lmmu$coefficients[2];	names(pmuslp) <- NULL # cleans up datasheet presentation			# mean square residual = parameter σ2  	lmsigmasq  <-  lm(varrunsums~c(1:length(varrunsums)))	psigmasqslp <- lmsigmasq$coefficients[2];	names(psigmasqslp) <- NULL # cleans up datasheet presentation	    # if sigma2slp is basically 0, can get sigma2<0 if answer 	    # should really be sigma2=0; check and replace if applicable    lmsigmasqsum <- summary(lmsigmasq)	if (psigmasqslp < 0 & lmsigmasqsum$sigma > .01) {
	   print("Sigma2slp less than 0 and not zero")	   }	if (psigmasqslp < 0 & lmsigmasqsum$sigma < .01) {
		psigmasqslp <- 0.00001 		print("Replaced neg sigma2slp with 1E-5")		}			return(data.frame(hmuslp=pmuslp, hsigmasqslp=psigmasqslp))}